From 9b98116372f5d211ddb9f68916d4ae73bf3c8da7 Mon Sep 17 00:00:00 2001
From: Adi Roiban <adi.roiban@chevah.com>
Date: Mon, 24 Jan 2022 23:53:54 +0000
Subject: [PATCH] Update after review.

---
 src/twisted/conch/ssh/transport.py       |  2 +-
 src/twisted/conch/test/test_transport.py | 14 +++++++-------
 2 files changed, 8 insertions(+), 8 deletions(-)

--- a/src/twisted/conch/ssh/transport.py
+++ b/src/twisted/conch/ssh/transport.py
@@ -697,7 +697,7 @@ class SSHTransportBase(protocol.Protocol
                 self.sendDisconnect(
                     DISCONNECT_CONNECTION_LOST,
                     b"Peer version string longer than 4KB. "
-                    b"Preventing a deny of service attack.",
+                    b"Preventing a denial of service attack.",
                 )
                 return
 
--- a/src/twisted/conch/test/test_transport.py
+++ b/src/twisted/conch/test/test_transport.py
@@ -557,18 +557,18 @@ class BaseSSHTransportTests(BaseSSHTrans
         sut = MockTransportBase()
         sut.makeConnection(self.transport)
 
-        sut.dataReceived(b"SSH-bla-bla-bla")
-
-        sut.dataReceived(b"more-bla-bla-bla" * 100)
-
+        # Data can be received over multiple chunks.
+        sut.dataReceived(b"SSH-2-Server-Identifier")
+        sut.dataReceived(b"1234567890" * 406)
+        sut.dataReceived(b"1235678")
         self.assertFalse(self.transport.disconnecting)
 
-        sut.dataReceived(b"more-bla-bla-bla" * 1000)
-
+        # Here we are going over the limit.
+        sut.dataReceived(b"1234567")
         # Once a lot of data is received without an SSH version string,
         # the transport is disconnected.
         self.assertTrue(self.transport.disconnecting)
-        self.assertIn(b"Preventing a deny of service attack", self.transport.value())
+        self.assertIn(b"Preventing a denial of service attack", self.transport.value())
 
     def test_sendPacketPlain(self):
         """
